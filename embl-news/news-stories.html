<!DOCTYPE html>
<html>
<head>
  <script src="//www.ebi.ac.uk/web_guidelines/EBI-Framework/v1.1/js/injectEBIFramework.js"></script>
  <script type="text/javascript">injectEBIFramework();</script>
  <meta charset="utf-8">
  <title> Analytics dashboards &lt; Analytics dashboards &lt; EMBL-EBI</title>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src="//www.ebi.ac.uk/web_guidelines/EBI-Framework/v1.1/libraries/tablesorter/dist/js/jquery.tablesorter.min.js"></script>
</head>
<body>
  <div id="content" role="main" class="row">
    <h2>EMBL News weekly dashbaord</h2>
    <section>

        <nav aria-label="You are here:" role="navigation">
          <ul class="breadcrumbs">
            <li><a href="//github.com/ebiwd/analytics-dashboards">EMBL-EBI Analytics dashboards</a></li>
            <!-- <li class="disabled">Disabled</li> -->
            <li>
              <span class="show-for-sr">Current: </span> This page
            </li>
          </ul>
        </nav>

        <div class="row" id="main-content-area">

<ul class="accordion" data-accordion data-multi-expand="true">

  <li class="accordion-item" data-accordion-item>
    <a href="#" class="accordion-title">Conceptual change list</a>
    <div class="accordion-content" data-tab-content>

      <ul>
        <li>JS link/event tracking</li>
        <ul>
          <li>Add ratio of clicks on content to overall page views</li>
          <li>Additional metrics and info might come in handy, such as pages (on the EMBL websites) visited from this page, searches performed, other actions taken (e.g. share button clicked, newsletter subscription etc.).</li>
        </ul>
        <li>Perhaps we should add desktop vs mobile stats per article?</li>
      </ul>
    </div>
  </li>  <li class="accordion-item" data-accordion-item>
    <a href="#" class="accordion-title">Polishing list</a>
    <div class="accordion-content" data-tab-content>

      <ul>
        <li>Referers: Aggregate stats</li>
        <li>And I’m wondering whether we should have a line in the chart pointing to an average traffic..or the green/orange/red indicator showing how the number of views relate to the average article... Like the idea of various “averages”. Instinct suggest that metric should come from a human — if you will: targets for news stories for # of visits, bounce rate, time on page, etc.</li>
        <li>Lock date selector to weeks</li>
        <li>Dev tasks</li>
        <ul>
          <li>Optimise code structure</li>
          <li>Expose somewhere for others to access. gh-pages? (users will still need to login to GA)</li>
        </ul>
      </ul>
    </div>
  </li>
  <li class="accordion-item is-active" data-accordion-item>
    <a href="#" class="accordion-title">Options</a>
    <div class="accordion-content" data-tab-content>
      <label for="originDate">Pick an end date for the week's report</label>
      <p class="small">Note, the report period will round to weekly units. Format is DD-MM-YYYY.</p>
      <input id="originDate" type="date" value=""/>
    </div>
  </li>
</ul>

<!-- Via: https://ga-dev-tools.appspot.com/embed-api/third-party-visualizations/ -->

<!-- Load the Embed API library. -->
<script>
(function(w,d,s,g,js,fs){
  g=w.gapi||(w.gapi={});g.analytics={q:[],ready:function(f){this.q.push(f);}};
  js=d.createElement(s);fs=d.getElementsByTagName(s)[0];
  js.src='https://apis.google.com/js/platform.js';
  fs.parentNode.insertBefore(js,fs);js.onload=function(){g.load('analytics');};
}(window,document,'script'));
</script>

<!-- A few misc style tweaks -->
<style>
  td.tr-referals {
    max-width: 400px;
    overflow: hidden;
    display: block;
  }
</style>

<!-- Load the components and their dependencies. -->
<!-- This demo uses the Chart.js graphing library and Moment.js to do date
     formatting and manipulation. -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.2/moment.min.js"></script>
<!-- Include the ViewSelector2 component script. -->
<!-- <script src="https://ga-dev-tools.appspot.com/public/javascript/embed-api/components/view-selector2.js"></script> -->
<!-- Include the DateRangeSelector component script. -->
<script src="https://ga-dev-tools.appspot.com/public/javascript/embed-api/components/date-range-selector.js"></script>
<!-- Include the ActiveUsers component script. -->
<!-- <script src="https://ga-dev-tools.appspot.com/public/javascript/embed-api/components/active-users.js"></script> -->
<!-- Include the CSS that styles the charts. -->
<!-- <link rel="stylesheet" href="https://ga-dev-tools.appspot.com/public/css/chartjs-visualizations.css"> -->


<!-- Add HTML containers to host the dashboard components. -->
<div>
  <pre><div id="embed-api-auth-container"></div></pre>
  <!-- <div id="view-selector-container"></div> -->
  <div id="view-name"></div>
  <div id="active-users-container"></div>
</div>

<h2 class="local-title">Loading...</h2>
<cite class="local-description"></cite>

<div class="Chartjs">
  <div class="label"></div>
  <figure class="Chartjs-figure" id="chart-1-container"></figure>
  <ol class="Chartjs-legend" id="legend-1-container"></ol>
</div>

<div class="traffic-overview"></div>

<hr />

<h3>Top stories from the past 7 days</h3>
<cite>Views are unique page views</cite>

<table id="table-report" class="hover tablesorter">
  <thead>
    <tr>
      <th width="">Story</th>
      <th width="">Views</th>
      <th width="">Referers</th>
      <th width="">Engagement</th>
      <th width="">Time on page (min)</th>
      <th width="">Bounce %</th>
    </tr>
  </thead>
  <tbody class="top-stories">
    <!-- <tr class="goal overall"> -->
  </tbody>
</table>

<div class="referer-test"></div>


<!-- charting stuff -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js"></script>
<link rel="stylesheet" href="https://ga-dev-tools.appspot.com/public/css/chartjs-visualizations.css">
<script src="charting-newstories.js"></script>

<!-- Write the dashboard code -->
<script src="ebiAnalyticsDashboard-newsstories.js"></script>

<script>

$(document).ready(function() {
  // Initialise all the queries.
  // This gets invoke when google is ready and when the user calls a refresh by selecting a date
  // requestedOriginDate = YYYYMMDD format, ie: 20170122
  function bootstrapCustomEBIAnalytics(requestedOriginDate) {
    // shared paramaters for all charts
    var shared = [];
    shared['filters'] = 'ga:pagePath!=/index.php;ga:pagePath!@/category/';
    shared['datePeriods'] = ['day','month','year'];
    shared['originDate'] = moment(requestedOriginDate, "YYYYMMDD"); // we allow user to specify an origin date
    shared['viewID'] = ['ga:91186979'];  //The GA property we want to view: www.ebi.ac.uk
    shared['clientid'] = '1025857412047-p3jieogi7mgkhb0dre41rm2ge3r8jn0s.apps.googleusercontent.com'; // get at https://console.developers.google.com/apis/credentials

    analyticsAuthorize(shared['clientid']);

    // Render traffic overview graph
    render_queue('.traffic-overview','traffic-overview','ga:date,ga:nthDay','ga:uniquePageviews',
      shared['filters']+'',shared);

    // Render all the of charts for this view.
    render_queue('.top-stories','overview-list','ga:pageTitle,ga:pagePath','ga:uniquePageviews',
      shared['filters']+'',shared);


    // $("#table-report").tablesorter();
  }

  // allow the user to change the query
  function enableUserDatePicking() {
    // set a default date
    document.getElementById("originDate").value = moment().format('YYYY-MM-DD');

    // update the report on date change
    function userChangedDate() {
      render_queue_time = 1; // reset the processing throttle
      $('tbody.top-stories').html(''); // empty the results
      var requestDate = moment(document.getElementById("originDate").value, 'YYYY-MM-DD');
      bootstrapCustomEBIAnalytics(requestDate);
    }

    // delay the invokation of the date change to not hammer the GAPI
    var userChangedDateTimeoutID;
    $('#originDate').change( function () {
      window.clearTimeout(userChangedDateTimeoutID); // delete any pending change that occured before the timeout cleared
      userChangedDateTimeoutID = window.setTimeout(userChangedDate, 750);
    });
  }

  // when the GAPI is ready, run the process
  gapi.analytics.ready(function() {
    var defaultDateNow = moment().format('YYYYMMDD');
    bootstrapCustomEBIAnalytics(defaultDateNow);

    enableUserDatePicking();
  });

});

</script>
     </div>
  </section>
</div><!-- /.container -->
<footer>
  <div id="local-footer">
    <div class="row">
      <div class="reference padding-top-large padding-bottom-large small">The EBI Visual Framework and Pattern libary are maintaind by <a href="https://github.com/ebiwd">Web Development</a> and overseen by <a href="https://www.ebi.ac.uk/seqdb/confluence/display/WGC/Meeting+notes">the Web Guidelines Committee</a>.</div>
    </div>
  </div>
</footer>

</body>
</html>
